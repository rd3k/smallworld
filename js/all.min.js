/**
 * Seedable random number generator functions.
 * @version 1.0.0
 * @license Public Domain
 *
 * @example
 * var rng = new RNG('Example');
 * rng.random(40, 50);  // =>  42
 * rng.uniform();       // =>  0.7972798995050903
 * rng.normal();        // => -0.6698504543216376
 * rng.exponential();   // =>  1.0547367609131555
 * rng.poisson(4);      // =>  2
 * rng.gamma(4);        // =>  2.781724687386858
 */
function RC4(t){this.s=new Array(256),this.i=0,this.j=0;for(var e=0;256>e;e++)this.s[e]=e;t&&this.mix(t)}function RNG(t){null==t?t=(Math.random()+Date.now()).toString():"function"==typeof t?(this.uniform=t,this.nextByte=function(){return~~(256*this.uniform())},t=null):"[object String]"!==Object.prototype.toString.call(t)&&(t=JSON.stringify(t)),this._normal=null,this._state=t?new RC4(t):null}var Viva=Viva||{};Viva.Graph=Viva.Graph||{},"undefined"!=typeof module&&module.exports&&(module.exports=Viva),Viva.Graph.version="0.5.7",Viva.lazyExtend=function(t,e){var n;if(t||(t={}),e)for(n in e)if(e.hasOwnProperty(n)){var r=t.hasOwnProperty(n),i=typeof e[n],o=!r||typeof t[n]!==i;o?t[n]=e[n]:"object"===i&&(t[n]=Viva.lazyExtend(t[n],e[n]))}return t},Viva.random=function(){var t,e=arguments[0];t="number"==typeof e?e:"string"==typeof e?e.length:+new Date;var n=function(){return t=4294967295&t+2127912214+(t<<12),t=4294967295&(3345072700^t^t>>>19),t=4294967295&t+374761393+(t<<5),t=4294967295&(t+3550635116^t<<9),t=4294967295&t+4251993797+(t<<3),t=4294967295&(3042594569^t^t>>>16),(268435455&t)/268435456};return{next:function(t){return Math.floor(n()*t)},nextDouble:function(){return n()}}},Viva.randomIterator=function(t,e){return e=e||Viva.random(),{forEach:function(n){var r,i,o;for(r=t.length-1;r>0;--r)i=e.next(r+1),o=t[i],t[i]=t[r],t[r]=o,n(o);t.length&&n(t[0])},shuffle:function(){var n,r,i;for(n=t.length-1;n>0;--n)r=e.next(n+1),i=t[r],t[r]=t[n],t[n]=i;return t}}},Viva.BrowserInfo=function(){if("undefined"==typeof window||!window.hasOwnProperty("navigator"))return{browser:"",version:"0"};var t=window.navigator.userAgent.toLowerCase(),e=/(webkit)[ \/]([\w.]+)/,n=/(opera)(?:.*version)?[ \/]([\w.]+)/,r=/(msie) ([\w.]+)/,i=/(mozilla)(?:.*? rv:([\w.]+))?/,o=e.exec(t)||n.exec(t)||r.exec(t)||0>t.indexOf("compatible")&&i.exec(t)||[];return{browser:o[1]||"",version:o[2]||"0"}}(),Viva.Graph.Utils=Viva.Graph.Utils||{},Viva.Graph.Utils.indexOfElementInArray=function(t,e){if(e.indexOf)return e.indexOf(t);var n,r=e.length;for(n=0;r>n;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},Viva.Graph.Utils=Viva.Graph.Utils||{},Viva.Graph.Utils.getDimension=function(t){if(!t)throw{message:"Cannot get dimensions of undefined container"};var e=t.clientWidth,n=t.clientHeight;return{left:0,top:0,width:e,height:n}},Viva.Graph.Utils.findElementPosition=function(t){var e=0,n=0;if(t.offsetParent)do e+=t.offsetLeft,n+=t.offsetTop;while(null!==(t=t.offsetParent));return[e,n]},Viva.Graph.Utils=Viva.Graph.Utils||{},Viva.Graph.Utils.events=function(t){var e=function(t){var e={};return t.fire=function(t,n){var r,i,o,a;if("string"!=typeof t)throw"Only strings can be used as even type";if(e.hasOwnProperty(t))for(r=e[t],a=0;r.length>a;++a)o=r[a],(i=o.method)(n);return this},t.addEventListener=function(t,n){if("function"!=typeof n)throw"Only functions allowed to be callbacks";var r={method:n};return e.hasOwnProperty(t)?e[t].push(r):e[t]=[r],this},t.removeEventListener=function(t,n){if("function"!=typeof n)throw"Only functions allowed to be callbacks";if(e.hasOwnProperty(t)){var r,i=e[t];for(r=0;i.length>r;++r)if(i[r].callback===n){i.splice(r);break}}return this},t.removeAllListeners=function(){var t;for(t in e)e.hasOwnProperty(t)&&delete e[t]},t};return{on:function(e,n){return t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n),this},stop:function(e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)},extend:function(){return e(t)}}},Viva.Graph.Utils=Viva.Graph.Utils||{},Viva.Graph.Utils.dragndrop=function(t){var e,n,r,i,o,a,s,u=Viva.Graph.Utils.events(window.document),f=Viva.Graph.Utils.events(t),c=Viva.Graph.Utils.findElementPosition,l=0,d=0,h=!1,p=0,v=function(t){var e=0,n=0;return t=t||window.event,t.pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+window.document.body.scrollLeft+window.document.documentElement.scrollLeft,n=t.clientY+window.document.body.scrollTop+window.document.documentElement.scrollTop),[e,n]},m=function(t,e,r){n&&n(t,{x:e-l,y:r-d}),l=e,d=r},g=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},y=function(t){t.preventDefault&&t.preventDefault()},x=function(t){return g(t),!1},w=function(t){t=t||window.event,m(t,t.clientX,t.clientY)},V=function(t){if(t=t||window.event,h)return g(t),!1;var n=1===t.button&&null!==window.event||0===t.button;return n?(l=t.clientX,d=t.clientY,s=t.target||t.srcElement,e&&e(t,{x:l,y:d}),u.on("mousemove",w),u.on("mouseup",b),g(t),o=window.document.onselectstart,a=window.document.ondragstart,window.document.onselectstart=x,s.ondragstart=x,!1):void 0},b=function(t){t=t||window.event,u.stop("mousemove",w),u.stop("mouseup",b),window.document.onselectstart=o,s.ondragstart=a,s=null,r&&r(t)},N=function(e){if("function"==typeof i){e=e||window.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1;var n,r=v(e),o=c(t),a={x:r[0]-o[0],y:r[1]-o[1]};n=e.wheelDelta?e.wheelDelta/360:e.detail/-9,i(e,n,a)}},G=function(e){!i&&e?"webkit"===Viva.BrowserInfo.browser?t.addEventListener("mousewheel",N,!1):t.addEventListener("DOMMouseScroll",N,!1):i&&!e&&("webkit"===Viva.BrowserInfo.browser?t.removeEventListener("mousewheel",N,!1):t.removeEventListener("DOMMouseScroll",N,!1)),i=e},P=function(t,e){return(t.clientX-e.clientX)*(t.clientX-e.clientX)+(t.clientY-e.clientY)*(t.clientY-e.clientY)},E=function(t){if(1===t.touches.length){g(t);var e=t.touches[0];m(t,e.clientX,e.clientY)}else if(2===t.touches.length){var n=P(t.touches[0],t.touches[1]),r=0;p>n?r=-1:n>p&&(r=1),i(t,r,{x:t.touches[0].clientX,y:t.touches[0].clientY}),p=n,g(t),y(t)}},L=function(t){h=!1,u.stop("touchmove",E),u.stop("touchend",L),u.stop("touchcancel",L),s=null,r&&r(t)},_=function(t,n){g(t),y(t),l=n.clientX,d=n.clientY,s=t.target||t.srcElement,e&&e(t,{x:l,y:d}),h||(h=!0,u.on("touchmove",E),u.on("touchend",L),u.on("touchcancel",L))},A=function(e){return console.log("Touch start for ",t),1===e.touches.length?_(e,e.touches[0]):void(2===e.touches.length&&(g(e),y(e),p=P(e.touches[0],e.touches[1])))};return f.on("mousedown",V),f.on("touchstart",A),{onStart:function(t){return e=t,this},onDrag:function(t){return n=t,this},onStop:function(t){return r=t,this},onScroll:function(t){return G(t),this},release:function(){u.stop("mousemove",w),u.stop("mousedown",V),u.stop("mouseup",b),u.stop("touchmove",E),u.stop("touchend",L),u.stop("touchcancel",L),G(null)}}},Viva.Input=Viva.Input||{},Viva.Input.domInputManager=function(t,e){var n={};return{bindDragNDrop:function(t,r){var i;if(r){var o=e.getNodeUI(t.id);i=Viva.Graph.Utils.dragndrop(o),"function"==typeof r.onStart&&i.onStart(r.onStart),"function"==typeof r.onDrag&&i.onDrag(r.onDrag),"function"==typeof r.onStop&&i.onStop(r.onStop),n[t.id]=i}else(i=n[t.id])&&(i.release(),delete n[t.id])}}},Viva.Graph.Utils=Viva.Graph.Utils||{},function(){var t,e,n=0,r=["ms","moz","webkit","o"];for(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:{setTimeout:function(){},clearTimeout:function(){}},t=0;r.length>t&&!e.requestAnimationFrame;++t){var i=r[t];e.requestAnimationFrame=e[i+"RequestAnimationFrame"],e.cancelAnimationFrame=e[i+"CancelAnimationFrame"]||e[i+"CancelRequestAnimationFrame"]}e.requestAnimationFrame||(e.requestAnimationFrame=function(t){var r=(new Date).getTime(),i=Math.max(0,16-(r-n)),o=e.setTimeout(function(){t(r+i)},i);return n=r+i,o}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(t){e.clearTimeout(t)}),Viva.Graph.Utils.timer=function(t){var n,r=function(){e.cancelAnimationFrame(n),n=0},i=function(){n=e.requestAnimationFrame(i),t()||r()};return i(),{stop:r,restart:function(){n||i()}}}}(),Viva.Graph.geom=function(){return{intersect:function(t,e,n,r,i,o,a,s){var u,f,c,l,d,h,p,v,m,g,y,x,w,V={x:0,y:0};return u=r-e,c=t-n,d=n*e-t*r,m=u*i+c*o+d,g=u*a+c*s+d,0!==m&&0!==g&&m>=0==g>=4?null:(f=s-o,l=i-a,h=a*o-i*s,p=f*t+l*e+h,v=f*n+l*r+h,0!==p&&0!==v&&p>=0==v>=0?null:(y=u*l-f*c,0===y?null:(x=0>y?-y/2:y/2,x=0,w=c*h-l*d,V.x=(0>w?w-x:w+x)/y,w=f*d-u*h,V.y=(0>w?w-x:w+x)/y,V)))},intersectRect:function(t,e,n,r,i,o,a,s){return this.intersect(t,e,t,r,i,o,a,s)||this.intersect(t,r,n,r,i,o,a,s)||this.intersect(n,r,n,e,i,o,a,s)||this.intersect(n,e,t,e,i,o,a,s)},convexHull:function(t){var e=function(t,e){var n,r,i=function(e){var n=e.x-t.x,r=e.y-t.y,i=n>0?1:-1;return i*n*n/(n*n+r*r)},o=e.sort(function(t,e){return i(e)-i(t)}),a=o[0],s=i(a),u=a.x-t.x,f=a.y-t.y,c=u*u+f*f;for(r=1;o.length>r;++r){a=o[r];var l=i(a);l===s?(u=a.x-t.x,f=a.y-t.y,n=u*u+f*f,c>n?o.splice(r,1):o.splice(r-1,1)):s=l}return o},n=function(t,e,n){return 0>(n.x-t.x)*(e.y-t.y)-(n.y-t.y)*(e.x-t.x)};if(3>t.length)return t;var r,i=0;for(r=0;t.length>r;++r)t[r].y<t[i].y?i=r:t[r].y===t[i].y&&t[r].x<t[i].x&&(i=r);var o=t[i];t.splice(i,1);var a=e(o,t);if(2>a.length)return a;var s=[];s.push(o),s.push(a[0]),s.push(a[1]);var u=s.length;for(r=2;a.length>r;++r){for(;!n(s[u-2],s[u-1],a[r]);)s.pop(),u-=1;s.push(a[r]),u+=1}return s}}},Viva.Graph.Rect=function(t,e,n,r){this.x1=t||0,this.y1=e||0,this.x2=n||0,this.y2=r||0},Viva.Graph.Point2d=function(t,e){this.x=t||0,this.y=e||0},Viva.Graph.Node=function(t){this.id=t,this.links=[],this.data=null},Viva.Graph.Link=function(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r},Viva.Graph.graph=function(){var t="function"==typeof Object.create?Object.create(null):{},e=[],n={},r=0,i=0,o=[],a=function(t){t.fire("changed",o)},s=function(){i+=1},u=function(t){i-=1,0===i&&o.length>0&&(a(t),o.length=0)},f=function(t,e){o.push({node:t,changeType:e})},c=function(t,e){o.push({link:t,changeType:e})},l={addNode:function(e,n){if(void 0===e)throw{message:"Invalid node identifier"};s();var i=this.getNode(e);return i?f(i,"update"):(i=new Viva.Graph.Node(e),r++,f(i,"add")),i.data=n,t[e]=i,u(this),i},addLink:function(t,r,i){s();var o=this.getNode(t)||this.addNode(t),a=this.getNode(r)||this.addNode(r),f=""+t+"ðŸ‘‰ "+r,l=n.hasOwnProperty(f);(l||this.hasLink(t,r))&&(l||(n[f]=0),f+="@"+ ++n[f]);var d=new Viva.Graph.Link(t,r,i,f);return e.push(d),o.links.push(d),a.links.push(d),c(d,"add"),u(this),d},removeLink:function(t){if(!t)return!1;var n=Viva.Graph.Utils.indexOfElementInArray(t,e);if(0>n)return!1;s(),e.splice(n,1);var r=this.getNode(t.fromId),i=this.getNode(t.toId);return r&&(n=Viva.Graph.Utils.indexOfElementInArray(t,r.links),n>=0&&r.links.splice(n,1)),i&&(n=Viva.Graph.Utils.indexOfElementInArray(t,i.links),n>=0&&i.links.splice(n,1)),c(t,"remove"),u(this),!0},removeNode:function(e){var n=this.getNode(e);if(!n)return!1;for(s();n.links.length;){var i=n.links[0];this.removeLink(i)}t[e]=null,delete t[e],r--,f(n,"remove"),u(this)},getNode:function(e){return t[e]},getNodesCount:function(){return r},getLinksCount:function(){return e.length},getLinks:function(t){var e=this.getNode(t);return e?e.links:null},forEachNode:function(e){if("function"==typeof e){var n;for(n in t)if(e(t[n]))return}},forEachLinkedNode:function(e,n,r){var i,o,a,s=this.getNode(e);if(s&&s.links&&"function"==typeof n)if(r)for(i=0;s.links.length>i;++i)o=s.links[i],o.fromId===e&&n(t[o.toId],o);else for(i=0;s.links.length>i;++i)o=s.links[i],a=o.fromId===e?o.toId:o.fromId,n(t[a],o)},forEachLink:function(t){var n,r;if("function"==typeof t)for(n=0,r=e.length;r>n;++n)t(e[n])},beginUpdate:function(){s()},endUpdate:function(){u(this)},clear:function(){var t=this;t.beginUpdate(),t.forEachNode(function(e){t.removeNode(e.id)}),t.endUpdate()},hasLink:function(t,e){var n,r=this.getNode(t);if(!r)return null;for(n=0;r.links.length>n;++n){var i=r.links[n];if(i.fromId===t&&i.toId===e)return i}return null}};return Viva.Graph.Utils.events(l).extend(),l},Viva.Graph.operations=function(){return{density:function(t,e){var n=t.getNodesCount();return 0===n?0/0:e?t.getLinksCount()/(n*(n-1)):2*t.getLinksCount()/(n*(n-1))}}},Viva.Graph.Physics=Viva.Graph.Physics||{},Viva.Graph.Physics.Vector=function(t,e){this.x=t||0,this.y=e||0},Viva.Graph.Physics.Vector.prototype={multiply:function(t){return new Viva.Graph.Physics.Vector(this.x*t,this.y*t)}},Viva.Graph.Physics.Point=function(t,e){this.x=t||0,this.y=e||0},Viva.Graph.Physics.Point.prototype={add:function(t){return new Viva.Graph.Physics.Point(this.x+t.x,this.y+t.y)}},Viva.Graph.Physics.Body=function(){this.mass=1,this.force=new Viva.Graph.Physics.Vector,this.velocity=new Viva.Graph.Physics.Vector,this.location=new Viva.Graph.Physics.Point,this.prevLocation=new Viva.Graph.Physics.Point},Viva.Graph.Physics.Body.prototype={loc:function(t){return t?(this.location.x=t.x,this.location.y=t.y,this):this.location},vel:function(t){return t?(this.velocity.x=t.x,this.velocity.y=t.y,this):this.velocity}},Viva.Graph.Physics.Spring=function(t,e,n,r,i){this.body1=t,this.body2=e,this.length=n,this.coeff=r,this.weight=i},Viva.Graph.Physics.QuadTreeNode=function(){this.centerOfMass=new Viva.Graph.Physics.Point,this.children=[],this.body=null,this.hasChildren=!1,this.x1=0,this.y1=0,this.x2=0,this.y2=0},Viva.Graph.Physics=Viva.Graph.Physics||{},Viva.Graph.Physics.eulerIntegrator=function(){return{integrate:function(t,e){var n,r=t.speedLimit,i=0,o=0,a=t.bodies.length;for(n=0;a>n;++n){var s=t.bodies[n],u=e/s.mass;s.velocity.x+=u*s.force.x,s.velocity.y+=u*s.force.y;var f=s.velocity.x,c=s.velocity.y,l=Math.sqrt(f*f+c*c);l>r&&(s.velocity.x=r*f/l,s.velocity.y=r*c/l),i=e*s.velocity.x,o=e*s.velocity.y,s.location.x+=i,s.location.y+=o}return i*i+o*o}}},Viva.Graph.Physics.nbodyForce=function(t){function e(t,e){this.node=t,this.body=e}function n(){this.stack=[],this.popIdx=0}t=Viva.lazyExtend(t||{gravity:-1,theta:.8}),n.prototype={isEmpty:function(){return 0===this.popIdx},push:function(t,n){var r=this.stack[this.popIdx];r?(r.node=t,r.body=n):this.stack[this.popIdx]=new e(t,n),++this.popIdx},pop:function(){return this.popIdx>0?this.stack[--this.popIdx]:void 0},reset:function(){this.popIdx=0}};var r=t.gravity,i=[],o=new n,a=t.theta,s=Viva.random("5f4dcc3b5aa765d61d8327deb882cf99",75,20,63,108,65,76,65,72),u=function(){this.body=null,this.quads=[],this.mass=0,this.massX=0,this.massY=0,this.left=0,this.top=0,this.bottom=0,this.right=0,this.isInternal=!1},f=[],c=0,l=function(){var t;return f[c]?(t=f[c],t.quads[0]=null,t.quads[1]=null,t.quads[2]=null,t.quads[3]=null,t.body=null,t.mass=t.massX=t.massY=0,t.left=t.right=t.top=t.bottom=0,t.isInternal=!1):(t=new u,f[c]=t),++c,t},d=l(),h=function(t,e){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return 1e-8>n&&1e-8>r},p=function(t){for(o.reset(),o.push(d,t);!o.isEmpty();){var e=o.pop(),n=e.node,r=e.body;if(n.isInternal){var i=r.location.x,a=r.location.y;n.mass=n.mass+r.mass,n.massX=n.massX+r.mass*i,n.massY=n.massY+r.mass*a;var u=0,f=n.left,c=(n.right+f)/2,p=n.top,v=(n.bottom+p)/2;if(i>c){u+=1;var m=f;f=c,c+=c-m}if(a>v){u+=2;var g=p;p=v,v+=v-g}var y=n.quads[u];y||(y=l(),y.left=f,y.top=p,y.right=c,y.bottom=v,n.quads[u]=y),o.push(y,r)}else if(n.body){var x=n.body;if(n.body=null,n.isInternal=!0,h(x.location,r.location)){if(1e-8>n.right-n.left)return;do{var w=s.nextDouble(),V=(n.right-n.left)*w,b=(n.bottom-n.top)*w;x.location.x=n.left+V,x.location.y=n.top+b}while(h(x.location,r.location))}o.push(n,x),o.push(n,r)}else n.body=r}},v=function(t){var e,n,o,u,f=i,c=1,l=0,h=1;for(f[0]=d;c;){var p=f[l],v=p.body;c-=1,l+=1,v&&v!==t?(n=v.location.x-t.location.x,o=v.location.y-t.location.y,u=Math.sqrt(n*n+o*o),0===u&&(n=(s.nextDouble()-.5)/50,o=(s.nextDouble()-.5)/50,u=Math.sqrt(n*n+o*o)),e=r*v.mass*t.mass/(u*u*u),t.force.x=t.force.x+e*n,t.force.y=t.force.y+e*o):(n=p.massX/p.mass-t.location.x,o=p.massY/p.mass-t.location.y,u=Math.sqrt(n*n+o*o),0===u&&(n=(s.nextDouble()-.5)/50,o=(s.nextDouble()-.5)/50,u=Math.sqrt(n*n+o*o)),a>(p.right-p.left)/u?(e=r*p.mass*t.mass/(u*u*u),t.force.x=t.force.x+e*n,t.force.y=t.force.y+e*o):(p.quads[0]&&(f[h]=p.quads[0],c+=1,h+=1),p.quads[1]&&(f[h]=p.quads[1],c+=1,h+=1),p.quads[2]&&(f[h]=p.quads[2],c+=1,h+=1),p.quads[3]&&(f[h]=p.quads[3],c+=1,h+=1)))}},m=function(t){var e,n=Number.MAX_VALUE,r=Number.MAX_VALUE,i=Number.MIN_VALUE,o=Number.MIN_VALUE,a=t.bodies,s=a.length;for(e=s;e--;){var u=a[e].location.x,f=a[e].location.y;n>u&&(n=u),u>i&&(i=u),r>f&&(r=f),f>o&&(o=f)}var h=i-n,v=o-r;for(h>v?o=r+h:i=n+v,c=0,d=l(),d.left=n,d.right=i,d.top=r,d.bottom=o,e=s;e--;)p(a[e],d)};return{insert:p,init:m,update:v,options:function(t){return t?("number"==typeof t.gravity&&(r=t.gravity),"number"==typeof t.theta&&(a=t.theta),this):{gravity:r,theta:a}}}},Viva.Graph.Physics.dragForce=function(t){t||(t={});var e={coeff:t.coeff||.01};return{update:function(t){t.force.x-=e.coeff*t.velocity.x,t.force.y-=e.coeff*t.velocity.y},options:function(t){return t?("number"==typeof t.coeff&&(e.coeff=t.coeff),this):e}}},Viva.Graph.Physics.springForce=function(t){t=Viva.lazyExtend(t,{length:50,coeff:22e-5});var e=Viva.random("Random number 4.","Chosen by fair dice roll");return{update:function(n){var r=n.body1,i=n.body2,o=0>n.length?t.length:n.length,a=i.location.x-r.location.x,s=i.location.y-r.location.y,u=Math.sqrt(a*a+s*s);0===u&&(a=(e.nextDouble()-.5)/50,s=(e.nextDouble()-.5)/50,u=Math.sqrt(a*a+s*s));var f=u-o,c=(!n.coeff||0>n.coeff?t.coeff:n.coeff)*f/u*n.weight;r.force.x+=c*a,r.force.y+=c*s,i.force.x+=-c*a,i.force.y+=-c*s},options:function(e){return e?("number"==typeof e.length&&(t.length=e.length),"number"==typeof e.coeff&&(t.coeff=e.coeff),this):t}}},Viva.Graph.Physics=Viva.Graph.Physics||{},Viva.Graph.Physics.forceSimulator=function(t){var e,n,r,i=t,o=[],a=[];return{speedLimit:1,bodies:o,accumulate:function(){var t,i;for(n.init(this),t=o.length;t--;)i=o[t],i.force.x=0,i.force.y=0,n.update(i),r.update(i);for(t=a.length;t--;)e.update(a[t])},run:function(t){return this.accumulate(),i.integrate(this,t)},addBody:function(t){if(!t)throw{message:"Cannot add null body to force simulator"};return o.push(t),t},removeBody:function(t){if(!t)return!1;var e=Viva.Graph.Utils.indexOfElementInArray(t,o);return 0>e?!1:o.splice(e,1)},addSpring:function(t,e,n,r,i){if(!t||!e)throw{message:"Cannot add null spring to force simulator"};if("number"!=typeof n)throw{message:"Spring length should be a number"};r="number"==typeof r?r:1;var o=new Viva.Graph.Physics.Spring(t,e,n,i>=0?i:-1,r);return a.push(o),o},removeSpring:function(t){if(!t)return!1;var e=Viva.Graph.Utils.indexOfElementInArray(t,a);return 0>e?!1:a.splice(e,1)},setNbodyForce:function(t){if(!t)throw{message:"Cannot add mighty (unknown) force to the simulator"};n=t},setDragForce:function(t){if(!t)throw{message:"Cannot add mighty (unknown) force to the simulator"};r=t},setSpringForce:function(t){if(!t)throw{message:"Cannot add unknown force to the simulator"};e=t}}},Viva.Graph.Layout=Viva.Graph.Layout||{},Viva.Graph.Layout.forceDirected=function(t,e){if(!t)throw{message:"Graph structure cannot be undefined"};e=Viva.lazyExtend(e,{springLength:80,springCoeff:2e-4,gravity:-1.2,theta:.8,dragCoeff:.02,springTransform:function(){},timeStep:20,stableThreshold:.001});var n=Viva.Graph.Physics.forceSimulator(Viva.Graph.Physics.eulerIntegrator()),r=Viva.Graph.Physics.nbodyForce({gravity:e.gravity,theta:e.theta}),i=Viva.Graph.Physics.springForce({length:e.springLength,coeff:e.springCoeff}),o=Viva.Graph.Physics.dragForce({coeff:e.dragCoeff}),a=new Viva.Graph.Rect,s=Viva.random("ted.com",103,114,101,97,116),u={},f=function(t){if(t.position)return t.position;var n=(a.x1+a.x2)/2,r=(a.y1+a.y2)/2,i=e.springLength;if(t.links&&t.links.length>0){var o=t.links[0],f=o.fromId!==t.id?u[o.fromId]:u[o.toId];f&&f.location&&(n=f.location.x,r=f.location.y)}return{x:n+s.next(i)-i/2,y:r+s.next(i)-i/2}},c=function(t){return u[t]},l=function(t){u[t]=null,delete u[t]},d={},h=function(e){var n=c(e);n.mass=1+t.getLinks(e).length/3},p=function(t){return t&&(t.isPinned||t.data&&t.data.isPinned)},v=function(t){return t.isPinned},m=function(e){var r=c(e);if(!r){var i=t.getNode(e);if(!i)return;r=new Viva.Graph.Physics.Body,u[e]=r;var o=f(i);r.loc(o),h(e),p(i)&&(r.isPinned=!0),n.addBody(r)}},g=function(t){m(t.id)},y=function(e){var r=c(e.id);r&&(l(e.id),n.removeBody(r),0===t.getNodesCount()&&(a.x1=a.y1=0,a.x2=a.y2=0))},x=function(t){h(t.fromId),h(t.toId);var r=c(t.fromId),i=c(t.toId),o=n.addSpring(r,i,-1,t.weight);e.springTransform(t,o),d[t.id]=o},w=function(e){var r=d[e.id];if(r){var i=t.getNode(e.fromId),o=t.getNode(e.toId);i&&h(i.id),o&&h(o.id),delete d[e.id],n.removeSpring(r)}},V=function(t){for(var e=0;t.length>e;++e){var n=t[e];"add"===n.changeType?(n.node&&m(n.node.id),n.link&&x(n.link)):"remove"===n.changeType&&(n.node&&y(n.node),n.link&&w(n.link))}},b=function(){t.forEachNode(g),t.forEachLink(x),t.addEventListener("changed",V)},N=function(){var e=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MIN_VALUE,i=Number.MIN_VALUE;if(0!==t.getNodesCount()){for(var o in u)if(u.hasOwnProperty(o)){var s=u[o];v(s)?(s.location.x=s.prevLocation.x,s.location.y=s.prevLocation.y):(s.prevLocation.x=s.location.x,s.prevLocation.y=s.location.y),e>s.location.x&&(e=s.location.x),s.location.x>r&&(r=s.location.x),n>s.location.y&&(n=s.location.y),s.location.y>i&&(i=s.location.y)}a.x1=e,a.x2=r,a.y1=n,a.y2=i}};return n.setSpringForce(i),n.setNbodyForce(r),n.setDragForce(o),b(),{run:function(t){var e;for(t=t||50,e=0;t>e;++e)this.step()},step:function(){var t=n.run(e.timeStep);return N(),e.stableThreshold>t},isNodePinned:function(t){var e=c(t.id);return e?v(e):void 0},pinNode:function(t,e){var n=c(t.id);n.isPinned=!!e},getNodePosition:function(t){var e=c(t);return e||(m(t),e=c(t)),e&&e.location},getLinkPosition:function(t){var e=this.getNodePosition(t.fromId),n=this.getNodePosition(t.toId);return{from:e,to:n}},setNodePosition:function(t,e,n){var r=c(t.id);r&&(r.prevLocation.x=r.location.x=e,r.prevLocation.y=r.location.y=n)},getGraphRect:function(){return a},dispose:function(){t.removeEventListener("change",V)},springLength:function(t){return 1===arguments.length?(i.options({length:t}),this):i.options().length},springCoeff:function(t){return 1===arguments.length?(i.options({coeff:t}),this):i.options().coeff},gravity:function(t){return 1===arguments.length?(r.options({gravity:t}),this):r.options().gravity},theta:function(t){return 1===arguments.length?(r.options({theta:t}),this):r.options().theta},drag:function(t){return 1===arguments.length?(o.options({coeff:t}),this):o.options().coeff}}},Viva.Graph.Layout=Viva.Graph.Layout||{},Viva.Graph.Layout.constant=function(t,e){e=Viva.lazyExtend(e,{maxX:1024,maxY:1024,seed:"Deterministic randomness made me do this"});var n=Viva.random(e.seed),r=new Viva.Graph.Rect(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),i=function(){return new Viva.Graph.Point2d(n.next(e.maxX),n.next(e.maxY))},o=function(t,e){t.x<e.x1&&(e.x1=t.x),t.x>e.x2&&(e.x2=t.x),t.y<e.y1&&(e.y1=t.y),t.y>e.y2&&(e.y2=t.y)},a="function"==typeof Object.create?Object.create(null):{},s=function(t){t&&(a[t.id]=i(t),o(a[t.id],r))},u=function(){0!==t.getNodesCount()&&(r.x1=Number.MAX_VALUE,r.y1=Number.MAX_VALUE,r.x2=Number.MIN_VALUE,r.y2=Number.MIN_VALUE,t.forEachNode(s))},f=function(t){for(var e=0;t.length>e;++e){var n=t[e];n.node&&("add"===n.changeType?s(n.node):delete a[n.node.id])}};return t.addEventListener("changed",f),{run:function(){this.step()},step:function(){return u(),!0},getGraphRect:function(){return r},dispose:function(){t.removeEventListener("change",f)},isNodePinned:function(){return!0},pinNode:function(){},getNodePosition:function(e){var n=a[e];return n||s(t.getNode(e)),n},getLinkPosition:function(t){var e=this.getNodePosition(t.fromId),n=this.getNodePosition(t.toId);return{from:e,to:n}},setNodePosition:function(t,e,n){var r=a[t.id];r&&(r.x=e,r.y=n)},placeNode:function(t){return"function"==typeof t?(i=t,u(),this):i(t)}}},Viva.Graph.View=Viva.Graph.View||{},Viva.Graph.View.renderer=function(t,e){var n=30;e=e||{};var r,i,o,a,s=e.layout,u=e.graphics,f=e.container,c=void 0!==e.interactive?e.interactive:!0,l=!1,d=!0,h=0,p=0,v=!1,m=!1,g={x:0,y:0},y={offsetX:0,offsetY:0,scale:1},x=function(){f=f||window.document.body,s=s||Viva.Graph.Layout.forceDirected(t),u=u||Viva.Graph.View.svgGraphics(t,{container:f}),e.hasOwnProperty("renderLinks")||(e.renderLinks=!0),e.prerender=e.prerender||0,r=(u.inputManager||Viva.Input.domInputManager)(t,u)},w=Viva.Graph.Utils.events(window),V=Viva.Graph.Utils.events({}).extend(),b=function(){u.beginRender(),e.renderLinks&&u.renderLinks(),u.renderNodes(),u.endRender()},N=function(){return v=s.step()&&!m,b(),!v},G=function(t){return i?void(p+=t):void(t?(p+=t,i=Viva.Graph.Utils.timer(function(){return N()},n)):(h=0,p=0,i=Viva.Graph.Utils.timer(N,n)))},P=function(){v=!1,i.restart()},E=function(){var t;if("number"==typeof e.prerender&&e.prerender>0)for(t=0;e.prerender>t;t+=1)s.step()},L=function(){var t=s.getGraphRect(),e=Viva.Graph.Utils.getDimension(f);g.x=g.y=0,y.offsetX=e.width/2-(t.x2+t.x1)/2,y.offsetY=e.height/2-(t.y2+t.y1)/2,u.graphCenterChanged(y.offsetX,y.offsetY),d=!1},_=function(t){var e=s.getNodePosition(t.id);u.addNode(t,e)},A=function(t){u.releaseNode(t)},I=function(t){var e=s.getLinkPosition(t);u.addLink(t,e)},k=function(t){u.releaseLink(t)},C=function(t){var e=!1,n="string"==typeof c&&-1!==c.indexOf("node")||c;n&&r.bindDragNDrop(t,{onStart:function(){e=s.isNodePinned(t),s.pinNode(t,!0),m=!0,P()},onDrag:function(e,n){var r=s.getNodePosition(t.id);s.setNodePosition(t,r.x+n.x/y.scale,r.y+n.y/y.scale),m=!0,b()},onStop:function(){s.pinNode(t,e),m=!1}})},T=function(t){r.bindDragNDrop(t,null)},M=function(){u.init(f),t.forEachNode(_),e.renderLinks&&t.forEachLink(I)},S=function(){u.release(f)},R=function(e){var n=e.node;"add"===e.changeType?(_(n),C(n),d&&L()):"remove"===e.changeType?(T(n),A(n),0===t.getNodesCount()&&(d=!0)):"update"===e.changeType&&(T(n),A(n),_(n),C(n))},U=function(t){var n=t.link;if("add"===t.changeType)e.renderLinks&&I(n);else if("remove"===t.changeType)e.renderLinks&&k(n);else if("update"===t.changeType)throw"Update type is not implemented. TODO: Implement me!"},D=function(t){var e,n;for(e=0;t.length>e;e+=1)n=t[e],n.node?R(n):n.link&&U(n);P()},F=function(){L(),N()},O=function(){a&&(a.release(),a=null)},z=function(){o&&(o.stop("changed",D),o=null)},B=function(t,e){if(!e){var n=Viva.Graph.Utils.getDimension(f);e={x:n.width/2,y:n.height/2}}var r=Math.pow(1.4,t?-.2:.2);y.scale=u.scale(r,e),b(),V.fire("scale",y.scale)},Y=function(){w.on("resize",F),O();var e="string"==typeof c&&-1!==c.indexOf("drag")||c;e&&(a=Viva.Graph.Utils.dragndrop(f),a.onDrag(function(t,e){g.x+=e.x,g.y+=e.y,u.translateRel(e.x,e.y),b()}));var n="string"==typeof c&&-1!==c.indexOf("scroll")||c;n&&a.onScroll(function(t,e,n){B(0>e,n)}),t.forEachNode(C),z(),o=Viva.Graph.Utils.events(t),o.on("changed",D)},X=function(){l=!1,z(),O(),w.stop("resize",F),V.removeAllListeners(),i.stop(),t.forEachLink(function(t){e.renderLinks&&k(t)}),t.forEachNode(function(t){T(t),A(t)}),s.dispose(),S()};return{run:function(t){return l||(x(),E(),L(),M(),Y(),l=!0),G(t),this},reset:function(){u.resetScale(),L(),y.scale=1},pause:function(){i.stop()},resume:function(){i.restart()},rerender:function(){return b(),this},zoomOut:function(){B(!0)},zoomIn:function(){B(!1)},moveTo:function(t,e){u.graphCenterChanged(y.offsetX-t*y.scale,y.offsetY-e*y.scale),b()},getGraphics:function(){return u},dispose:function(){X()},on:function(t,e){return V.addEventListener(t,e),this},off:function(t,e){return V.removeEventListener(t,e),this}}},Viva.Graph.serializer=function(){var t=function(){if("undefined"==typeof JSON||!JSON.stringify||!JSON.parse)throw"JSON serializer is not defined."},e=function(t){return{id:t.id,data:t.data}},n=function(t){return{fromId:t.fromId,toId:t.toId,data:t.data}},r=function(t){return t},i=function(t){return t};return{storeToJSON:function(r,i,o){if(!r)throw"Graph is not defined";t(),i=i||e,o=o||n;var a={nodes:[],links:[]};return r.forEachNode(function(t){a.nodes.push(i(t))}),r.forEachLink(function(t){a.links.push(o(t))}),JSON.stringify(a)},loadFromJSON:function(e,n,o){if("string"!=typeof e)throw"String expected in loadFromJSON() method";t(),n=n||r,o=o||i;var a,s=JSON.parse(e),u=Viva.Graph.graph();if(!s||!s.nodes||!s.links)throw"Passed json string does not represent valid graph";for(a=0;s.nodes.length>a;++a){var f=n(s.nodes[a]);if(!f.hasOwnProperty("id"))throw"Graph node format is invalid. Node.id is missing";u.addNode(f.id,f.data)}for(a=0;s.links.length>a;++a){var c=o(s.links[a]);if(!c.hasOwnProperty("fromId")||!c.hasOwnProperty("toId"))throw"Graph link format is invalid. Both fromId and toId are required";u.addLink(c.fromId,c.toId,c.data)}return u}}},Viva.Graph.centrality=function(){var t=function(t,e,n){var r,i,o,a={},s=[],u={},f={},c=[e.id],l=function(t){f.hasOwnProperty(t.id)||(c.push(t.id),f[t.id]=i+1),f[t.id]===i+1&&(u[t.id]+=o,a[t.id].push(r))};for(t.forEachNode(function(t){a[t.id]=[],u[t.id]=0}),f[e.id]=0,u[e.id]=1;c.length;)r=c.shift(),i=f[r],o=u[r],s.push(r),t.forEachLinkedNode(r,l,n);return{S:s,P:a,sigma:u}},e=function(t,e,n){var r,i,o,a,s,u={},f=e.S;for(r=0;f.length>r;r+=1)u[f[r]]=0;for(;f.length;){for(i=f.pop(),o=(1+u[i])/e.sigma[i],a=e.P[i],r=0;a.length>r;r+=1)s=a[r],u[s]+=e.sigma[s]*o;i!==n&&(t[i]+=u[i])}},n=function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push({key:e,value:t[e]});return n.sort(function(t,e){return e.value-t.value})};return{betweennessCentrality:function(r){var i,o={};return r.forEachNode(function(t){o[t.id]=0}),r.forEachNode(function(n){i=t(r,n),e(o,i,n)}),n(o)},degreeCentrality:function(t,e){var n,r,i=[],o=[];if(e=(e||"both").toLowerCase(),"in"===e)n=function(t,e){var n,r=0;for(n=0;t.length>n;n+=1)r+=t[n].toId===e?1:0;return r};else if("out"===e)n=function(t,e){var n,r=0;for(n=0;t.length>n;n+=1)r+=t[n].fromId===e?1:0;return r};else{if("both"!==e)throw"Expected centrality degree kind is: in, out or both";n=function(t){return t.length}}t.forEachNode(function(e){var r=t.getLinks(e.id),o=n(r,e.id);i.hasOwnProperty(o)?i[o].push(e.id):i[o]=[e.id]});for(r in i)if(i.hasOwnProperty(r)){var a,s=i[r];if(s)for(a=0;s.length>a;++a)o.unshift({key:s[a],value:parseInt(r,10)})}return o}}},Viva.Graph.community=function(){return{slpa:function(t,e,n){var r=Viva.Graph._community.slpaAlgorithm(t,e,n);return r.run()}}},Viva.Graph._community={},Viva.Graph._community.slpaAlgorithm=function(t,e,n){e=e||100,n=n||.3;var r=Viva.random(1331782216905),i=Viva.random("Greeting goes to you, ","dear reader"),o=function(t,n){var r=[];return t.forEachUniqueWord(function(t,i){return i>n?void r.push({name:t,probability:i/e}):!0}),r},a=function(t){var e=[];return t.forEachNode(function(t){var n=Viva.Graph._community.occuranceMap(r);n.add(t.id),t.slpa={memory:n},e.push(t.id)}),e},s=function(t,n){var o,a=Viva.randomIterator(n,i),s=function(e){var n=t.getNode(e),i=Viva.Graph._community.occuranceMap(r);t.forEachLinkedNode(e,function(t){var e=t.slpa.memory.getRandomWord();i.add(e)});var o=i.getMostPopularFair();n.slpa.memory.add(o)};for(o=0;e-1>o;++o)a.forEach(s)},u=function(t){var r={};return t.forEachNode(function(t){var i,a=o(t.slpa.memory,n*e);for(i=0;a.length>i;++i){var s=a[i].name;r.hasOwnProperty(s)?r[s].push(t.id):r[s]=[t.id]}t.communities=a,t.slpa=null,delete t.slpa}),r};return{run:function(){var e=a(t);return s(t,e),u(t)}}},Viva.Graph._community.occuranceMap=function(t){t=t||Viva.random();var e={},n=[],r=!1,i=[],o=function(){var t;i.length=0;for(t in e)e.hasOwnProperty(t)&&i.push(t);i.sort(function(t,n){var r=e[n]-e[t];return r?r:n>t?-1:t>n?1:0})},a=function(){r&&(o(),r=!1)};return{add:function(t){t+="",e.hasOwnProperty(t)?e[t]+=1:e[t]=1,n.push(t),r=!0},getWordCount:function(t){return e[t]||0},getMostPopularFair:function(){if(1===n.length)return n[0];a();var r,o=0;for(r=1;i.length>r&&e[i[r-1]]===e[i[r]];++r)o+=1;return o+=1,i[t.next(o)]},getRandomWord:function(){if(0===n.length)throw"The occurance map is empty. Cannot get empty word";return n[t.next(n.length)]},forEachUniqueWord:function(t){if("function"!=typeof t)throw"Function callback is expected to enumerate all words";var n;for(a(),n=0;i.length>n;++n){var r=i[n],o=e[r],s=t(r,o);if(s)break}}}},Viva.Graph.generator=function(){return{complete:function(t){if(!t||1>t)throw{message:"At least two nodes expected for complete graph"};var e,n,r=Viva.Graph.graph();for(r.Name="Complete K"+t,e=0;t>e;++e)for(n=e+1;t>n;++n)e!==n&&r.addLink(e,n);
return r},completeBipartite:function(t,e){if(!t||!e||0>t||0>e)throw{message:"Graph dimensions are invalid. Number of nodes in each partition should be greate than 0"};var n,r,i=Viva.Graph.graph();for(i.Name="Complete K "+t+","+e,n=0;t>n;++n)for(r=t;t+e>r;++r)i.addLink(n,r);return i},ladder:function(t){if(!t||0>t)throw{message:"Invalid number of nodes"};var e,n=Viva.Graph.graph();for(n.Name="Ladder graph "+t,e=0;t-1>e;++e)n.addLink(e,e+1),n.addLink(t+e,t+e+1),n.addLink(e,t+e);return n.addLink(t-1,2*t-1),n},circularLadder:function(t){if(!t||0>t)throw{message:"Invalid number of nodes"};var e=this.ladder(t);return e.Name="Circular ladder graph "+t,e.addLink(0,t-1),e.addLink(t,2*t-1),e},grid:function(t,e){var n,r,i=Viva.Graph.graph();for(i.Name="Grid graph "+t+"x"+e,n=0;t>n;++n)for(r=0;e>r;++r){var o=n+r*t;n>0&&i.addLink(o,n-1+r*t),r>0&&i.addLink(o,n+(r-1)*t)}return i},path:function(t){if(!t||0>t)throw{message:"Invalid number of nodes"};var e,n=Viva.Graph.graph();for(n.Name="Path graph "+t,n.addNode(0),e=1;t>e;++e)n.addLink(e-1,e);return n},lollipop:function(t,e){if(!e||0>e||!t||0>t)throw{message:"Invalid number of nodes"};var n,r=this.complete(t);for(r.Name="Lollipop graph. Head x Path "+t+"x"+e,n=0;e>n;++n)r.addLink(t+n-1,t+n);return r},balancedBinTree:function(t){var e,n=Viva.Graph.graph(),r=Math.pow(2,t);for(n.Name="Balanced bin tree graph "+t,e=1;r>e;++e){var i=e,o=2*i,a=2*i+1;n.addLink(i,o),n.addLink(i,a)}return n},randomNoLinks:function(t){if(!t||0>t)throw{message:"Invalid number of nodes"};var e,n=Viva.Graph.graph();for(n.Name="Random graph, no Links: "+t,e=0;t>e;++e)n.addNode(e);return n}}},Viva.Graph.View=Viva.Graph.View||{},Viva.Graph.View.cssGraphics=function(){var t,e,n,r="OLD_IE",i=1,o=1,a=function(){var t,e,n=Viva.BrowserInfo.browser;switch(n){case"mozilla":t="Moz";break;case"webkit":t="webkit";break;case"opera":t="O";break;case"msie":if(e=Viva.BrowserInfo.version.split(".")[0],!(e>8))return r;t="ms"}return t?t+"Transform":null}(),s=function(){return a===r?function(t,e,n,r){var i=Math.cos(r),o=Math.sin(r);0>r&&(r=2*Math.PI+r),Math.PI/2>r?(t.style.left=e+"px",t.style.top=n+"px"):Math.PI>r?(t.style.left=e-t.clientWidth*Math.cos(Math.PI-r),t.style.top=n):Math.PI+Math.PI/2>r?(t.style.left=e-t.clientWidth*Math.cos(Math.PI-r),t.style.top=n+t.clientWidth*Math.sin(Math.PI-r)):(t.style.left=e,t.style.top=n+t.clientWidth*Math.sin(Math.PI-r)),t.style.filter='progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand",M11='+i+", M12="+-o+",M21="+o+", M22="+i+");"}:a?function(t,e,n,r){t.style.left=e+"px",t.style.top=n+"px",t.style[a]="rotate("+r+"rad)",t.style[a+"Origin"]="left"}:function(){}}(),u=function(){var t=window.document.createElement("div");return t.setAttribute("class","node"),t},f=function(t,e){t.style.left=e.x-5+"px",t.style.top=e.y-5+"px"},c=function(t,e,n){var r=e.x-n.x,i=e.y-n.y,o=Math.sqrt(r*r+i*i);t.style.height="1px",t.style.width=o+"px",s(t,n.x,n.y,Math.atan2(i,r))},l=function(){var t=window.document.createElement("div");return t.setAttribute("class","link"),t},d=function(){if(t){if(!a||a===r)throw"Not implemented. TODO: Implement OLD_IE Filter based transform";var s="matrix("+i+", 0, 0,"+o+","+e+","+n+")";t.style[a]=s}};return{node:function(t){return t&&"function"!=typeof t?u(t):(u=t,this)},link:function(t){return t&&"function"!=typeof t?l(t):(l=t,this)},inputManager:Viva.Input.domInputManager,graphCenterChanged:function(t,r){e=t,n=r,d()},translateRel:function(t,r){e+=t,n+=r,d()},scale:function(){return 1},resetScale:function(){return this},beginRender:function(){},endRender:function(){},placeNode:function(t){return f=t,this},placeLink:function(t){return c=t,this},init:function(e){t=e,d()},initLink:function(e){t.childElementCount>0?t.insertBefore(e,t.firstChild):t.appendChild(e)},releaseLink:function(e){t.removeChild(e)},initNode:function(e){t.appendChild(e)},releaseNode:function(e){t.removeChild(e)},updateNodePosition:function(t,e){f(t,e)},updateLinkPosition:function(t,e,n){c(t,e,n)}}},Viva.Graph.svg=function(t){var e="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xlink",r=t;return"string"==typeof t&&(r=window.document.createElementNS(e,t)),r.vivagraphAugmented?r:(r.vivagraphAugmented=!0,r.attr=function(t,e){return 2===arguments.length?(null!==e?r.setAttributeNS(null,t,e):r.removeAttributeNS(null,t),r):r.getAttributeNS(null,t)},r.append=function(t){var e=Viva.Graph.svg(t);return r.appendChild(e),e},r.text=function(t){return void 0!==t?(r.textContent=t,r):r.textContent},r.link=function(t){return arguments.length?(r.setAttributeNS(n,"xlink:href",t),r):r.getAttributeNS(n,"xlink:href")},r.children=function(t){var e,n,i=[],o=r.childNodes.length;if(void 0===t&&r.hasChildNodes())for(e=0;o>e;e++)i.push(Viva.Graph.svg(r.childNodes[e]));else if("string"==typeof t){var a="."===t[0],s="#"===t[0],u=!a&&!s;for(e=0;o>e;e++){var f=r.childNodes[e];if(1===f.nodeType){var c=f.attr("class"),l=f.attr("id"),d=f.nodeName;if(a&&c){for(c=c.replace(/\s+/g," ").split(" "),n=0;c.length>n;n++)if(a&&c[n]===t.substr(1)){i.push(Viva.Graph.svg(f));break}}else{if(s&&l===t.substr(1)){i.push(Viva.Graph.svg(f));break}u&&d===t&&i.push(Viva.Graph.svg(f))}i=i.concat(Viva.Graph.svg(f).children(t))}}if(s&&1===i.length)return i[0]}return i},r)},Viva.Graph.View=Viva.Graph.View||{},Viva.Graph.View.svgGraphics=function(){var t,e,n,r,i,o=1,a={},s={},u=function(){return Viva.Graph.svg("rect").attr("width",10).attr("height",10).attr("fill","#00a2e8")},f=function(t,e){t.attr("x",e.x-5).attr("y",e.y-5)},c=function(){return Viva.Graph.svg("line").attr("stroke","#999")},l=function(t,e,n){t.attr("x1",e.x).attr("y1",e.y).attr("x2",n.x).attr("y2",n.y)},d=function(t){t.fire("rescaled")},h={x:0,y:0},p={x:0,y:0},v={x:0,y:0},m=function(){if(t){var e="matrix("+o+", 0, 0,"+o+","+n+","+r+")";t.attr("transform",e)}},g={getNodeUI:function(t){return a[t]},getLinkUI:function(t){return s[t]},node:function(t){return"function"==typeof t?(u=t,this):void 0},link:function(t){return"function"==typeof t?(c=t,this):void 0},placeNode:function(t){return f=t,this},placeLink:function(t){return l=t,this},beginRender:function(){},endRender:function(){},graphCenterChanged:function(t,e){n=t,r=e,m()},inputManager:Viva.Input.domInputManager,translateRel:function(n,r){var i=e.createSVGPoint(),o=t.getCTM(),a=e.createSVGPoint().matrixTransform(o.inverse());i.x=n,i.y=r,i=i.matrixTransform(o.inverse()),i.x=(i.x-a.x)*o.a,i.y=(i.y-a.y)*o.d,o.e+=i.x,o.f+=i.y;var s="matrix("+o.a+", 0, 0,"+o.d+","+o.e+","+o.f+")";t.attr("transform",s)},scale:function(i,a){var s=e.createSVGPoint();s.x=a.x,s.y=a.y,s=s.matrixTransform(t.getCTM().inverse());var u=e.createSVGMatrix().translate(s.x,s.y).scale(i).translate(-s.x,-s.y),f=t.getCTM().multiply(u);o=f.a,n=f.e,r=f.f;var c="matrix("+f.a+", 0, 0,"+f.d+","+f.e+","+f.f+")";return t.attr("transform",c),d(this),o},resetScale:function(){o=1;var e="matrix(1, 0, 0, 1, 0, 0)";return t.attr("transform",e),d(this),this},init:function(n){e=Viva.Graph.svg("svg"),t=Viva.Graph.svg("g").attr("buffered-rendering","dynamic"),e.appendChild(t),n.appendChild(e),m(),"function"==typeof i&&i(e)},release:function(t){e&&t&&t.removeChild(e)},addLink:function(e,n){var r=c(e);return r?(r.position=n,r.link=e,s[e.id]=r,t.childElementCount>0?t.insertBefore(r,t.firstChild):t.appendChild(r),r):void 0},releaseLink:function(e){var n=s[e.id];n&&(t.removeChild(n),delete s[e.id])},addNode:function(e,n){var r=u(e);return r?(r.position=n,r.node=e,a[e.id]=r,t.appendChild(r),r):void 0},releaseNode:function(e){var n=a[e.id];n&&(t.removeChild(n),delete a[e.id])},renderNodes:function(){for(var t in a)if(a.hasOwnProperty(t)){var e=a[t];h.x=e.position.x,h.y=e.position.y,f(e,h,e.node)}},renderLinks:function(){for(var t in s)if(s.hasOwnProperty(t)){var e=s[t];p.x=e.position.from.x,p.y=e.position.from.y,v.x=e.position.to.x,v.y=e.position.to.y,l(e,p,v,e.link)}},getGraphicsRoot:function(t){return"function"==typeof t&&(e?t(e):i=t),e},getSvgRoot:function(){return e}};return Viva.Graph.Utils.events(g).extend(),g},Viva.Graph.View.svgNodeFactory=function(t){var e="#999",n=Viva.Graph.geom(),r=function(t){t.size={w:10,h:10},t.append("rect").attr("width",t.size.w).attr("height",t.size.h).attr("stroke","orange").attr("fill","orange")},i=function(t){return t.size};return{node:function(t){var e=Viva.Graph.svg("g");return r(e,t),e.nodeId=t.id,e},link:function(n){var r=t.getNode(n.fromId),i=r&&r.ui;if(i&&!i.linksContainer){var o=Viva.Graph.svg("path").attr("stroke",e);return i.linksContainer=o,o}return null},customContent:function(t,e){if("function"!=typeof t||"function"!=typeof e)throw"Two functions expected: contentCreator(nodeUI, node) and size(nodeUI)";r=t,i=e},placeNode:function(e,r){var o="",a=i(e);t.forEachLinkedNode(e.nodeId,function(t,s){if(t.position&&t.ui&&t.ui!==e&&s.fromId===e.nodeId){var u=i(t.ui),f=t.position,c=n.intersectRect(r.x-a.w/2,r.y-a.h/2,r.x+a.w/2,r.y+a.h/2,r.x,r.y,f.x,f.y)||r,l=n.intersectRect(f.x-u.w/2,f.y-u.h/2,f.x+u.w/2,f.y+u.h/2,f.x,f.y,r.x,r.y)||f;o+="M"+Math.round(c.x)+" "+Math.round(c.y)+"L"+Math.round(l.x)+" "+Math.round(l.y)}}),e.attr("transform","translate("+(r.x-a.w/2)+", "+(r.y-a.h/2)+")"),""!==o&&e.linksContainer&&e.linksContainer.attr("d",o)}}},Viva.Graph.webgl=function(t){var e=function(e,n){var r=t.createShader(n);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(r);throw window.alert(i),i}return r};return{createProgram:function(n,r){var i=t.createProgram(),o=e(n,t.VERTEX_SHADER),a=e(r,t.FRAGMENT_SHADER);if(t.attachShader(i,o),t.attachShader(i,a),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){var s=t.getShaderInfoLog(i);throw window.alert(s),s}return i},extendArray:function(t,e,n){if((e+1)*n>t.length){var r=new Float32Array(2*t.length*n);return r.set(t),r}return t},copyArrayPart:function(t,e,n,r){var i;for(i=0;r>i;++i)t[e+i]=t[n+i]},swapArrayPart:function(t,e,n,r){var i;for(i=0;r>i;++i){var o=t[e+i];t[e+i]=t[n+i],t[n+i]=o}},getLocations:function(e,n){var r,i={};for(r=0;n.length>r;++r){var o=n[r],a=-1;if(0===o.indexOf("a_")){if(a=t.getAttribLocation(e,o),-1===a)throw"Program doesn't have required attribute: "+o;i[o.slice(2)]=a}else{if(0!==o.indexOf("u_"))throw"Couldn't figure out your intent. All uniforms should start with 'u_' prefix, and attributes with 'a_'";if(a=t.getUniformLocation(e,o),null===a)throw"Program doesn't have required uniform: "+o;i[o.slice(2)]=a}}return i},context:t}},Viva.Graph.View.WebglUtils=function(){},Viva.Graph.View.WebglUtils.prototype.parseColor=function(t){var e=10414335;if("string"==typeof t&&t)if(4===t.length&&(t=t.replace(/([^#])/g,"$1$1")),9===t.length)e=parseInt(t.substr(1),16);else{if(7!==t.length)throw'Color expected in hex format with preceding "#". E.g. #00ff00. Got value: '+t;e=255|parseInt(t.substr(1),16)<<8}else"number"==typeof t&&(e=t);return e},Viva.Graph.View._webglUtil=new Viva.Graph.View.WebglUtils,Viva.Graph.View.webglLine=function(t){return{color:Viva.Graph.View._webglUtil.parseColor(t)}},Viva.Graph.View.webglSquare=function(t,e){return{size:"number"==typeof t?t:10,color:Viva.Graph.View._webglUtil.parseColor(e)}},Viva.Graph.View.webglImage=function(t,e){return{_texture:0,_offset:0,size:"number"==typeof t?t:32,src:e}},Viva.Graph.View.webglNodeProgram=function(){var t,e,n,r,i,o,a,s,u,f=4,c=3*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT,l=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n"),d=["attribute vec3 a_vertexPos;","attribute vec4 a_color;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","varying vec4 color;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos.xy/u_screenSize, 0, 1);","   gl_PointSize = a_vertexPos.z * u_transform[0][0];","   color = a_color.abgr;","}"].join("\n"),h=new ArrayBuffer(16*c),p=new Float32Array(h),v=new Uint32Array(h),m=0,g=function(){if((m+1)*c>=h.byteLength){var t=new ArrayBuffer(2*h.byteLength),e=new Float32Array(t),n=new Uint32Array(t);n.set(v),p=e,v=n,h=t}};return{load:function(o){e=o,i=Viva.Graph.webgl(o),t=i.createProgram(d,l),e.useProgram(t),r=i.getLocations(t,["a_vertexPos","a_color","u_screenSize","u_transform"]),e.enableVertexAttribArray(r.vertexPos),e.enableVertexAttribArray(r.color),n=e.createBuffer()},position:function(t,e){var n=t.id;p[n*f]=e.x,p[n*f+1]=e.y,p[n*f+2]=t.size,v[n*f+3]=t.color},updateTransform:function(t){u=!0,s=t},updateSize:function(t,e){o=t,a=e,u=!0},removeNode:function(t){m>0&&(m-=1),m>t.id&&m>0&&i.copyArrayPart(v,t.id*f,m*f,f)},createNode:function(){g(),m+=1},replaceProperties:function(){},render:function(){e.useProgram(t),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,h,e.DYNAMIC_DRAW),u&&(u=!1,e.uniformMatrix4fv(r.transform,!1,s),e.uniform2f(r.screenSize,o,a)),e.vertexAttribPointer(r.vertexPos,3,e.FLOAT,!1,f*Float32Array.BYTES_PER_ELEMENT,0),e.vertexAttribPointer(r.color,4,e.UNSIGNED_BYTE,!0,f*Float32Array.BYTES_PER_ELEMENT,12),e.drawArrays(e.POINTS,0,m)}}},Viva.Graph.View.webglLinkProgram=function(){var t,e,n,r,i,o,a,s,u,f,c=6,l=2*(2*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT),d=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n"),h=["attribute vec2 a_vertexPos;","attribute vec4 a_color;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","varying vec4 color;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0.0, 1.0);","   color = a_color.abgr;","}"].join("\n"),p=0,v=new ArrayBuffer(16*l),m=new Float32Array(v),g=new Uint32Array(v),y=function(){if((p+1)*l>v.byteLength){var t=new ArrayBuffer(2*v.byteLength),e=new Float32Array(t),n=new Uint32Array(t);n.set(g),m=e,g=n,v=t}};return{load:function(o){e=o,r=Viva.Graph.webgl(o),t=r.createProgram(h,d),e.useProgram(t),i=r.getLocations(t,["a_vertexPos","a_color","u_screenSize","u_transform"]),e.enableVertexAttribArray(i.vertexPos),e.enableVertexAttribArray(i.color),n=e.createBuffer()},position:function(t,e,n){var r=t.id,i=r*c;m[i]=e.x,m[i+1]=e.y,g[i+2]=t.color,m[i+3]=n.x,m[i+4]=n.y,g[i+5]=t.color},createLink:function(t){y(),p+=1,o=t.id},removeLink:function(t){p>0&&(p-=1),p>t.id&&p>0&&r.copyArrayPart(g,t.id*c,p*c,c)},updateTransform:function(t){f=!0,u=t},updateSize:function(t,e){a=t,s=e,f=!0},render:function(){e.useProgram(t),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,v,e.DYNAMIC_DRAW),f&&(f=!1,e.uniformMatrix4fv(i.transform,!1,u),e.uniform2f(i.screenSize,a,s)),e.vertexAttribPointer(i.vertexPos,2,e.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),e.vertexAttribPointer(i.color,4,e.UNSIGNED_BYTE,!0,3*Float32Array.BYTES_PER_ELEMENT,8),e.drawArrays(e.LINES,0,2*p),o=p-1},bringToFront:function(t){o>t.id&&r.swapArrayPart(m,t.id*c,o*c,c),o>0&&(o-=1)},getFrontLinkId:function(){return o}}},Viva.Graph.View.Texture=function(t){this.canvas=window.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.isDirty=!1,this.canvas.width=this.canvas.height=t},Viva.Graph.View.webglAtlas=function(t){var e,n,r=Math.sqrt(t||1024)<<0,i=r,o=1,a={},s=0,u=[],f=[],c=function(t){return 0===(t&t-1)},l=function(){var t=new Viva.Graph.View.Texture(r*i);u.push(t)},d=function(e){var n=e/t<<0,i=e%t,o=i/r<<0,a=i%r;return{textureNumber:n,row:o,col:a}},h=function(){n.isDirty=!0,s=0,e=null},p=function(){e&&(window.clearTimeout(e),s+=1,e=null),s>10?h():e=window.setTimeout(h,400)},v=function(t,e){var n=u[t.textureNumber].canvas,r=u[e.textureNumber].ctx,o=e.col*i,a=e.row*i;r.drawImage(n,t.col*i,t.row*i,i,i,o,a,i,i),u[t.textureNumber].isDirty=!0,u[e.textureNumber].isDirty=!0},m=function(t,e,n){var r=d(t),o={offset:t};r.textureNumber>=u.length&&l();var s=u[r.textureNumber];s.ctx.drawImage(e,r.col*i,r.row*i,i,i),f[t]=e.src,a[e.src]=o,s.isDirty=!0,n(o)};if(!c(t))throw"Tiles per texture should be power of two.";return n={isDirty:!1,clearDirty:function(){var t;for(this.isDirty=!1,t=0;u.length>t;++t)u[t].isDirty=!1},remove:function(t){var e=a[t];if(!e)return!1;if(delete a[t],o-=1,o===e.offset)return!0;var n=d(e.offset),r=d(o);v(r,n);var i=a[f[o]];return i.offset=e.offset,f[e.offset]=f[o],p(),!0},getTextures:function(){return u},getCoordinates:function(t){return a[t]},load:function(t,e){if(a.hasOwnProperty(t))e(a[t]);else{var n=new window.Image,r=o;o+=1,n.crossOrigin="anonymous",n.onload=function(){p(),m(r,n,e)},n.src=t}}}},Viva.Graph.View.webglImageNodeProgram=function(){var t,e,n,r,i,o,a,s,u,f,c=18,l=["precision mediump float;","varying vec4 color;","varying vec3 vTextureCoord;","uniform sampler2D u_sampler0;","uniform sampler2D u_sampler1;","uniform sampler2D u_sampler2;","uniform sampler2D u_sampler3;","void main(void) {","   if (vTextureCoord.z == 0.) {","     gl_FragColor = texture2D(u_sampler0, vTextureCoord.xy);","   } else if (vTextureCoord.z == 1.) {","     gl_FragColor = texture2D(u_sampler1, vTextureCoord.xy);","   } else if (vTextureCoord.z == 2.) {","     gl_FragColor = texture2D(u_sampler2, vTextureCoord.xy);","   } else if (vTextureCoord.z == 3.) {","     gl_FragColor = texture2D(u_sampler3, vTextureCoord.xy);","   } else { gl_FragColor = vec4(0, 1, 0, 1); }","}"].join("\n"),d=["attribute vec2 a_vertexPos;","attribute float a_customAttributes;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","uniform float u_tilesPerTexture;","varying vec3 vTextureCoord;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0, 1);","float corner = mod(a_customAttributes, 4.);","float tileIndex = mod(floor(a_customAttributes / 4.), u_tilesPerTexture);","float tilesPerRow = sqrt(u_tilesPerTexture);","float tileSize = 1./tilesPerRow;","float tileColumn = mod(tileIndex, tilesPerRow);","float tileRow = floor(tileIndex/tilesPerRow);","if(corner == 0.0) {","  vTextureCoord.xy = vec2(0, 1);","} else if(corner == 1.0) {","  vTextureCoord.xy = vec2(1, 1);","} else if(corner == 2.0) {","  vTextureCoord.xy = vec2(0, 0);","} else {","  vTextureCoord.xy = vec2(1, 0);","}","vTextureCoord *= tileSize;","vTextureCoord.x += tileColumn * tileSize;","vTextureCoord.y += tileRow * tileSize;","vTextureCoord.z = floor(floor(a_customAttributes / 4.)/u_tilesPerTexture);","}"].join("\n"),h=1024,p=0,v=new Float32Array(64),m=function(t,e){t.nativeObject&&n.deleteTexture(t.nativeObject);var r=n.createTexture();n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t.canvas),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_NEAREST),n.generateMipmap(n.TEXTURE_2D),n.uniform1i(o["sampler"+e],e),t.nativeObject=r},g=function(){if(t.isDirty){var e,n=t.getTextures();for(e=0;n.length>e;++e)(n[e].isDirty||!n[e].nativeObject)&&m(n[e],e);t.clearDirty()}};return{load:function(a){n=a,i=Viva.Graph.webgl(a),t=new Viva.Graph.View.webglAtlas(h),e=i.createProgram(d,l),n.useProgram(e),o=i.getLocations(e,["a_vertexPos","a_customAttributes","u_screenSize","u_transform","u_sampler0","u_sampler1","u_sampler2","u_sampler3","u_tilesPerTexture"]),n.uniform1f(o.tilesPerTexture,h),n.enableVertexAttribArray(o.vertexPos),n.enableVertexAttribArray(o.customAttributes),r=n.createBuffer()},position:function(t,e){var n=t.id*c;v[n]=e.x-t.size,v[n+1]=e.y-t.size,v[n+2]=4*t._offset,v[n+3]=e.x+t.size,v[n+4]=e.y-t.size,v[n+5]=4*t._offset+1,v[n+6]=e.x-t.size,v[n+7]=e.y+t.size,v[n+8]=4*t._offset+2,v[n+9]=e.x-t.size,v[n+10]=e.y+t.size,v[n+11]=4*t._offset+2,v[n+12]=e.x+t.size,v[n+13]=e.y-t.size,v[n+14]=4*t._offset+1,v[n+15]=e.x+t.size,v[n+16]=e.y+t.size,v[n+17]=4*t._offset+3},createNode:function(e){v=i.extendArray(v,p,c),p+=1;var n=t.getCoordinates(e.src);n?e._offset=n.offset:(e._offset=0,t.load(e.src,function(t){e._offset=t.offset}))},removeNode:function(e){p>0&&(p-=1),p>e.id&&p>0&&(e.src&&t.remove(e.src),i.copyArrayPart(v,e.id*c,p*c,c))},replaceProperties:function(t,e){e._offset=t._offset},updateTransform:function(t){f=!0,u=t},updateSize:function(t,e){a=t,s=e,f=!0},render:function(){n.useProgram(e),n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,v,n.DYNAMIC_DRAW),f&&(f=!1,n.uniformMatrix4fv(o.transform,!1,u),n.uniform2f(o.screenSize,a,s)),n.vertexAttribPointer(o.vertexPos,2,n.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),n.vertexAttribPointer(o.customAttributes,1,n.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,8),g(),n.drawArrays(n.TRIANGLES,0,6*p)}}},Viva.Graph.View=Viva.Graph.View||{},Viva.Graph.View.webglGraphics=function(t){t=Viva.lazyExtend(t,{enableBlending:!0,preserveDrawingBuffer:!1,clearColor:!1,clearColorValue:{r:1,g:1,b:1,a:1}});var e,n,r,i,o,a,s,u,f=0,c=0,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[],h=[],p={},v={},m=Viva.Graph.View.webglLinkProgram(),g=Viva.Graph.View.webglNodeProgram(),y=function(){return Viva.Graph.View.webglSquare()},x=function(){return Viva.Graph.View.webglLine(3014898687)},w=function(){m.updateTransform(l),g.updateTransform(l)},V=function(){l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},b=function(){e&&n&&(i=n.width=Math.max(e.offsetWidth,1),o=n.height=Math.max(e.offsetHeight,1),r&&r.viewport(0,0,i,o),m&&m.updateSize(i/2,o/2),g&&g.updateSize(i/2,o/2))},N=function(t){t.fire("rescaled")},G={getLinkUI:function(t){return v[t]},getNodeUI:function(t){return p[t]},node:function(t){return"function"==typeof t?(y=t,this):void 0},link:function(t){return"function"==typeof t?(x=t,this):void 0},placeNode:function(t){return a=t,this},placeLink:function(t){return s=t,this},inputManager:Viva.Input.webglInputManager,beginRender:function(){},endRender:function(){c>0&&m.render(),f>0&&g.render()},bringLinkToFront:function(t){var e,n,r=m.getFrontLinkId();m.bringToFront(t),r>t.id&&(e=t.id,n=h[r],h[r]=h[e],h[r].id=r,h[e]=n,h[e].id=e)},graphCenterChanged:function(t,e){l[12]=2*t/i-1,l[13]=1-2*e/o,w()},addLink:function(t,e){var n=c++,r=x(t);return r.id=n,r.pos=e,m.createLink(r),h[n]=r,v[t.id]=r,r},addNode:function(t,e){var n=f++,r=y(t);return r.id=n,r.position=e,r.node=t,g.createNode(r),d[n]=r,p[t.id]=r,r},translateRel:function(t,e){l[12]+=2*l[0]*t/i/l[0],l[13]-=2*l[5]*e/o/l[5],w()},scale:function(t,e){var n=2*e.x/i-1,r=1-2*e.y/o;return n-=l[12],r-=l[13],l[12]+=n*(1-t),l[13]+=r*(1-t),l[0]*=t,l[5]*=t,w(),N(this),l[0]},resetScale:function(){return V(),r&&(b(),w()),this},init:function(a){var s={};if(t.preserveDrawingBuffer&&(s.preserveDrawingBuffer=!0),e=a,n=window.document.createElement("canvas"),b(),V(),e.appendChild(n),r=n.getContext("experimental-webgl",s),!r){var f="Could not initialize WebGL. Seems like the browser doesn't support it.";throw window.alert(f),f}if(t.enableBlending&&(r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND)),t.clearColor){var c=t.clearColorValue;r.clearColor(c.r,c.g,c.b,c.a),this.beginRender=function(){r.clear(r.COLOR_BUFFER_BIT)}}m.load(r),m.updateSize(i/2,o/2),g.load(r),g.updateSize(i/2,o/2),w(),"function"==typeof u&&u(n)},release:function(t){n&&t&&t.removeChild(n)},isSupported:function(){var t=window.document.createElement("canvas"),e=t&&t.getContext&&t.getContext("experimental-webgl");return e},releaseLink:function(t){c>0&&(c-=1);var e=v[t.id];delete v[t.id],m.removeLink(e);var n=e.id;if(c>n){if(0===c||c===n)return;var r=h[c];h[n]=r,r.id=n}},releaseNode:function(t){f>0&&(f-=1);var e=p[t.id];delete p[t.id],g.removeNode(e);var n=e.id;if(f>n){if(0===f||f===n)return;var r=d[f];d[n]=r,r.id=n,g.replaceProperties(e,r)}},renderNodes:function(){for(var t={x:0,y:0},e=0;f>e;++e){var n=d[e];t.x=n.position.x,t.y=-n.position.y,a&&a(n,t),g.position(n,t)}},renderLinks:function(){if(!this.omitLinksRendering)for(var t={x:0,y:0},e={x:0,y:0},n=0;c>n;++n){var r=h[n],i=r.pos.from;e.x=i.x,e.y=-i.y,i=r.pos.to,t.x=i.x,t.y=-i.y,s&&s(r,e,t),m.position(r,e,t)}},getGraphicsRoot:function(t){return"function"==typeof t&&(n?t(n):u=t),n},setNodeProgram:function(t){if(!r&&t)g=t;else if(t)throw"Not implemented. Cannot swap shader on the fly... yet."},setLinkProgram:function(t){if(!r&&t)m=t;else if(t)throw"Not implemented. Cannot swap shader on the fly... yet."},transformClientToGraphCoordinates:function(t){return t.x=2*t.x/i-1,t.y=1-2*t.y/o,t.x=(t.x-l[12])/l[0],t.y=(t.y-l[13])/l[5],t.x*=i/2,t.y*=-o/2,t},getNodeAtClientPos:function(t,e){if("function"!=typeof e)return null;this.transformClientToGraphCoordinates(t);for(var n=0;f>n;++n)if(e(d[n],t.x,t.y))return d[n].node;return null}};return Viva.Graph.Utils.events(G).extend(),G},Viva.Graph.webglInputEvents=function(t){if(t.webglInputEvents)return t.webglInputEvents;var e,n,r=function(t,e,n){if(t&&t.size){var r=t.position,i=t.size;return e>r.x-i&&r.x+i>e&&n>r.y-i&&r.y+i>n}return!0},i=function(e){return t.getNodeAtClientPos(e,r)},o=null,a=[],s=[],u=[],f=[],c=[],l=[],d=[],h=Viva.Graph.Utils.events(window.document),p=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},v=function(t){return p(t),!1},m=function(t,e){var n,r;for(n=0;t.length>n;n+=1)if(r=t[n].apply(void 0,e))return!0},g=function(t){var r={x:0,y:0},g=null,y=+new Date,x=function(t){m(c,[g,t]),r.x=t.clientX,r.y=t.clientY},w=function(){h.stop("mousemove",x),h.stop("mouseup",w)},V=function(){n=t.getBoundingClientRect()};window.addEventListener("resize",V),V(),t.addEventListener("mousemove",function(t){if(!o){var e,u=!1;r.x=t.clientX-n.left,r.y=t.clientY-n.top,e=i(r),e&&g!==e?(g=e,u=u||m(a,[g])):null===e&&g!==e&&(u=u||m(s,[g]),g=null),u&&p(t)}}),t.addEventListener("mousedown",function(t){var o,a=!1;r.x=t.clientX-n.left,r.y=t.clientY-n.top,o=[i(r),t],o[0]?(a=m(u,o),h.on("mousemove",x),h.on("mouseup",w),e=window.document.onselectstart,window.document.onselectstart=v,g=o[0]):g=null,a&&p(t)}),t.addEventListener("mouseup",function(t){var o,a=+new Date;r.x=t.clientX-n.left,r.y=t.clientY-n.top,o=[i(r),t],o[0]&&(window.document.onselectstart=e,400>a-y&&o[0]===g?m(d,o):m(l,o),y=a,m(f,o)&&p(t))})};return t.getGraphicsRoot(g),t.webglInputEvents={mouseEnter:function(t){return"function"==typeof t&&a.push(t),this},mouseLeave:function(t){return"function"==typeof t&&s.push(t),this},mouseDown:function(t){return"function"==typeof t&&u.push(t),this},mouseUp:function(t){return"function"==typeof t&&f.push(t),this},mouseMove:function(t){return"function"==typeof t&&c.push(t),this},click:function(t){return"function"==typeof t&&l.push(t),this},dblClick:function(t){return"function"==typeof t&&d.push(t),this},mouseCapture:function(t){o=t},releaseMouseCapture:function(){o=null}},t.webglInputEvents},Viva.Input=Viva.Input||{},Viva.Input.webglInputManager=function(t,e){var n=Viva.Graph.webglInputEvents(e),r=null,i={},o={x:0,y:0};return n.mouseDown(function(t,e){r=t,o.x=e.clientX,o.y=e.clientY,n.mouseCapture(r);var a=i[t.id];return a&&a.onStart&&a.onStart(e,o),!0}).mouseUp(function(t){n.releaseMouseCapture(r),r=null;var e=i[t.id];return e&&e.onStop&&e.onStop(),!0}).mouseMove(function(t,e){if(r){var n=i[r.id];return n&&n.onDrag&&n.onDrag(e,{x:e.clientX-o.x,y:e.clientY-o.y}),o.x=e.clientX,o.y=e.clientY,!0}}),{bindDragNDrop:function(t,e){i[t.id]=e,e||delete i[t.id]}}},RC4.getStringBytes=function(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n),i=[];do i.push(255&r),r>>=8;while(r>0);e=e.concat(i.reverse())}return e},RC4.prototype._swap=function(t,e){var n=this.s[t];this.s[t]=this.s[e],this.s[e]=n},RC4.prototype.mix=function(t){for(var e=RC4.getStringBytes(t),n=0,r=0;r<this.s.length;r++)n+=this.s[r]+e[r%e.length],n%=256,this._swap(r,n)},RC4.prototype.next=function(){return this.i=(this.i+1)%256,this.j=(this.j+this.s[this.i])%256,this._swap(this.i,this.j),this.s[(this.s[this.i]+this.s[this.j])%256]},RNG.prototype.nextByte=function(){return this._state.next()},RNG.prototype.uniform=function(){for(var t=7,e=0,n=0;t>n;n++)e*=256,e+=this.nextByte();return e/(Math.pow(2,8*t)-1)},RNG.prototype.random=function(t,e){return null==t?this.uniform():(null==e&&(e=t,t=0),t+Math.floor(this.uniform()*(e-t)))},RNG.prototype.normal=function(){if(null!==this._normal){var t=this._normal;return this._normal=null,t}var e=this.uniform()||Math.pow(2,-53),n=this.uniform();return this._normal=Math.sqrt(-2*Math.log(e))*Math.sin(2*Math.PI*n),Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*n)},RNG.prototype.exponential=function(){return-Math.log(this.uniform()||Math.pow(2,-53))},RNG.prototype.poisson=function(t){var e=Math.exp(-(t||1)),n=0,r=1;do n++,r*=this.uniform();while(r>e);return n-1},RNG.prototype.gamma=function(t){var e=(1>t?1+t:t)-1/3,n=1/Math.sqrt(9*e);do{do var r=this.normal(),i=Math.pow(n*r+1,3);while(0>=i);var o=this.uniform(),a=Math.pow(r,2)}while(o>=1-.0331*a*a&&Math.log(o)>=.5*a+e*(1-i+Math.log(i)));return 1>t?e*i*Math.exp(this.exponential()/-t):e*i},RNG.roller=function(t,e){var n=t.split(/(\d+)?d(\d+)([+-]\d+)?/).slice(1),r=parseFloat(n[0])||1,i=parseFloat(n[1]),o=parseFloat(n[2])||0;return e=e||new RNG,function(){for(var t=r+o,n=0;r>n;n++)t+=e.random(i);return t}},RNG.$=new RNG;var App;!function(t){var e;!function(t){t[t.Dijkstra=0]="Dijkstra",t[t.BFS=1]="BFS",t[t.FloydWarshall=2]="FloydWarshall"}(e||(e={}))}(App||(App={}));var App;!function(t){var e;!function(t){t[t.WattsStrogatz=0]="WattsStrogatz",t[t.NewmannWatts=1]="NewmannWatts"}(e||(e={}))}(App||(App={}));